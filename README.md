IPwatchD
========
**IP conflict detection tool for Linux**

## Table of Contents

* [Overview](#overview)
  * [What is IPwatchD?](#what-is-ipwatchd)
  * [Who uses IPwatchD?](#who-uses-ipwatchd)
* [Download](#download)
* [Documentation](#documentation)
* [FAQ](#faq)
* [Quick Start](#quick-start)
  * [IPwatchD requirements](#ipwatchd-requirements)
  * [Building IPwatchD](#building-ipwatchd)
  * [Building IPwatchD G Notify](#building-ipwatchd-g-notify)
  * [What gets installed](#what-gets-installed)
  * [IPwatchD configuration](#ipwatchd-configuration)
* [Changelog](#changelog)
* [Links](#links)
* [About](#about)

## Home

### What is IPwatchD?

IPwatchD is a simple daemon that analyses all incoming ARP packets in order to detect IP conflicts on Linux. It is released under the terms of the [GNU General Public License version 2](http://www.gnu.org/licenses/gpl-2.0.html).

IPwatchD can be configured to listen on one or more interfaces (alias interfaces are also supported) in active or passive mode. In active mode it protects your host before IP takeover by answering Gratuitous ARP requests received from conflicting system. In passive mode it just records information about conflict through standard syslog interface.

IPwatchD also supports execution of user-defined scripts that can for example show bubble notification on user's desktop.

### Who uses IPwatchD?

IPwatchD is available in standard repositories of [Debian](http://www.debian.org/) ([more](http://packages.debian.org/wheezy/ipwatchd)), [Ubuntu](http://www.ubuntu.com/) ([more](http://packages.ubuntu.com/precise/ipwatchd)) and [Fedora](http://fedoraproject.org/) ([more](https://apps.fedoraproject.org/packages/ipwatchd/)). [CentOS](http://www.centos.org/) and [Red Hat Enterprise Linux](http://www.redhat.com/products/enterprise-linux/) users are encouraged to use [EPEL repository](http://fedoraproject.org/wiki/EPEL) ([more](http://dl.fedoraproject.org/pub/epel/6/i386/repoview/ipwatchd.html)). IPwatchD is also standard part of many enterprise-grade software and hardware products such as [Acronis vmProtect](http://www.acronis.com/enterprise/products/vmprotect/) ([more](http://kb.acronis.com/content/37319)), [NETGEAR ReadyNAS](http://www.readynas.com/) ([more](http://www.foxnetwork.ru/index.php/en/component/content/article/78-netgear-readynas-ultra-2-plus.html)) or [RADVISION Scopia XT5000](http://www.radvision.com/Products/Video-Conference-Systems/Conference-Room-Systems/XT5000/) ([more](http://www.radvision.com/NR/rdonlyres/DD0036D9-5F2F-41B5-A7D6-7CA36DEAFF3D/0/ThirdPartyTermsforSCOPIAXT5000copyrightnotice.pdf)).

## Download

Current stable version of IPwatchD is 1.2.1

You can download it from sourceforge [project page](http://www.sourceforge.net/projects/ipwatchd).

Tarballs with source code since version 1.2 are signed with [new GnuPG key of Jaroslav Imrich](http://www.jariq.sk/media/jariq2.asc). Tarballs with source code before version 1.2 are signed with [old GnuPG key of Jaroslav Imrich](http://www.jariq.sk/media/jariq1.asc).

You can also browse SVN repository through [web interface](https://svn.code.sf.net/p/ipwatchd/code/) or checkout development version with commands:

    $ svn checkout https://svn.code.sf.net/p/ipwatchd/code/current ipwatchd

## Documentation

[ipwatchd(8)](http://ipwatchd.sourceforge.net/ipwatchd.8.html) [ipwatchd.conf(5)](http://ipwatchd.sourceforge.net/ipwatchd.conf.5.html) [ipwatchd-script(1)](http://ipwatchd.sourceforge.net/ipwatchd-script.1.html) [ipwatchd-gnotify(1)](http://ipwatchd.sourceforge.net/ipwatchd-gnotify.1.html)  
HTML version of IPwatchD manual pages

[Activity diagram](http://ipwatchd.sourceforge.net/ipwatchd-diagram.png)  
Activity diagram of IPwatchD - good start for developers

[Code documentation](http://ipwatchd.sourceforge.net/doxygen/)  
Documentation of IPwatchD source code useful for developers

[Test scenarios](http://ipwatchd.sourceforge.net/testcases.pdf)  
Document describing how to test IPwatchD functionality

[IPwatchD an IP conflict detection tool for Linux](http://www.linuxconfig.org/IPwatchD_an_IP_conflict_detection_tool_for_Linux)  
Article about IPwatchD published on linuxconfig.org

[Detection of IP conflict in Linux](http://ipwatchd.sourceforge.net/ipwatchd-whitepaper.pdf)  
White paper written by IPwatchD author

## FAQ

**1. Is this project abandoned/dead?**  
IPwatchD project is neither abandoned nor dead. It is just in the stable phase where there are no new releases until there are no new bugs found.

**2. IPwatchD does not work! It did not detect my IP conflict!**  
In order to detect IP conflict the machine running IPwatchD has to receive ARP broadcasts generated by the conflicting host. Some machines generate ARP broadcasts during the change of IP address others don't. In such cases you have to wait until some other host on your network initiates communication with the conflicting IP address. Conflicting machine will most likely use ARP broadcasts during the initiation of new communication with the other host and this will give IPwatchD a chance to detect IP conflict. You can find out more about this topic in my whitepaper "[Detection of IP conflict in Linux](http://ipwatchd.sourceforge.net/ipwatchd-whitepaper.pdf)".

**3. Can IPwatchD running on my server detect all IP conflicts in my LAN?**  
IPwatchD is designed to monitor and protect only the system it is running on. If you want to monitor a whole network you should rather use [arpwatch](http://ee.lbl.gov/).

**4. I have installed IPwatchD but it did not resolve the conflict.**  
IPwatchD does not resolve the IP conflicts it just informs the user that IP conflict exists. Please note that IP conflict is a serious network misconfiguration and it should be resolved by changing IP address of one of the conflicting hosts.

**5. I have read [an article describing how to use IPwatchD to automatically win the race for IP address](http://weiwu.sdf.org/100704.html). What do you think about it?**  
Exactly the same "aggressive behavior" as described in that article can be achieved without send_arp just by using active protection mode with defend_interval set to 0. However I strongly discourage you from this kind of setup. IP conflict is a serious network misconfiguration and it should be resolved by changing IP address of one of the conflicting hosts.

**6. Does IPwatchD support IPv6?**  
IPwatchD currently supports only IPv4 mostly because I don't use IPv6 on my systems. While it should be possible to use IPv6 Neighbor Discovery Protocol (NDP) to perform Duplicate address detection (DAD) I will probably do nothing about it until I start using IPv6 on my own systems. Collaborators and/or sponsors are welcome meanwhile :)

**7. Desktop notifications do not work! Log entry with IP conflict exists but I've seen no notification bubble.**  
Desktop notifications are displayed by the separate application IPwatchD-G-Notify that is executed by IPwatchD daemon whenever the IP conflict occurs. It is a completely optional extension for desktop users and it is not needed on server machines.

IPwatchD-G-Notify displays notifications via libnotify which unfortunately has no support for "system-wide messages" and because of that IPwatchD-G-Notify uses little workaround when it tries to write message to all busses available. That is the main reason why IPwatchD-G-Notify requires less restrictive setup of D-BUS where root is allowed to write messages to busses belonging to regular users and this kind of setup can be found only in Debian/Ubuntu based distributions.

On other distributions you can either monitor system logs for information about IP conflict recorded by IPwatchD daemon or you can switch to Debian/Ubuntu :)

**8. I have installed IPwatchD on RHEL but when I want to start daemon I am getting error "/etc/init.d/ipwatchd: line 34: /lib/init/vars.sh: No such file or directory". What should I do?**  
Init script shipped with IPwatchD 1.2.1 is designed for Debian/Ubuntu based distributions. You should replace the file "/etc/init.d/ipwatchd" with [this one](https://svn.code.sf.net/p/ipwatchd/code/current/src/scripts/centos/ipwatchd) on RedHat derivatives.

## Quick Start

### IPwatchD requirements

To build IPwatchD from source code you will need gcc, libpcap and libnet1 installed in your system.

To build IPwatchD G Notify (Notification tool for Gnome environment) you will also need libnotify.

On Ubuntu 10.04 it should be sufficient to install following packages:

* **build-essential**  
  C compiler and other development tools

* **libpcap-dev**  
  Network packet capture library

* **libnet1-dev**  
  Network packet construction library

* **libnotify-dev**  
  Desktop notification library

### Building IPwatchD

Download IPwatchD 1.2.1 source from sourceforge [project page](http://www.sourceforge.net/projects/ipwatchd).

Extract the code and build it:

    $ gunzip ipwatchd-1.2.1.tar.gz
    $ tar -xf ipwatchd-1.2.1.tar
    $ cd ipwatchd-1.2.1/src
    $ apt-get install libnet1-dev libpcap-dev
    $ make

You can install IPwatchD as root with command:

    # make install

You can uninstall IPwatchD as root with command:

    # make uninstall

### Building IPwatchD G Notify

Download IPwatchD G Notify 1.0.1 source from sourceforge [project page](http://www.sourceforge.net/projects/ipwatchd).

Extract the code and build it:

    $ gunzip ipwatchd-gnotify-1.0.1.tar.gz
    $ tar -xf ipwatchd-gnotify-1.0.1.tar
    $ cd ipwatchd-gnotify-1.0.1/src
    $ apt-get install libnet1-dev libpcap-dev
    $ make

You can install IPwatchD G Notify as root with command:

    # make install

You can uninstall IPwatchD G Notify as root with command:

    # make uninstall

### What gets installed

* **/etc/ipwatchd.conf**  
  Configuration file

* **/etc/init.d/ipwatchd**  
  Init script

* **/usr/sbin/ipwatchd**  
  Daemon executable

* **/usr/sbin/ipwatchd-script**  
  User-defined script

* **/usr/share/man/man8/ipwatchd.8.gz**
  Manual page

* **/usr/share/man/man5/ipwatchd.conf.5.gz**  
  Manual page

* **/usr/share/man/man1/ipwatchd-script.1.gz**  
  Manual page

* **/usr/sbin/ipwatchd-gnotify**  
  Gnome notification tool

* **/usr/share/man/man1/ipwatchd-gnotify.1.gz**  
  Manual page

### IPwatchD configuration

Edit configuration file /etc/ipwatchd.conf with your favorite text editor to suite your needs.

You can run IPwatchD as root with init script:

    # /etc/init.d/ipwatchd start

Or you can run it with command:

    # /usr/sbin/ipwatchd -c /etc/ipwatchd.conf

For more information please read [manual pages](http://ipwatchd.sourceforge.net/documentation).

## Changelog

**1.2.1** (2011-07-24)  
- added support for libnotify 0.7
- errors for interfaces without IP address are no longer logged
- loopback devices are skipped in automatic configuration mode
- fixed false posivite with more than one interface connected to the same subnet
- fixed possible socket leaking
- added manual pages ipwatchd-script(1) and ipwatchd.conf(5)

**1.2** (2010-01-06)
- added test scenarios
- all messages are sysloged
- lot of small changes that make packaging for Ubuntu easier
- added PID file (needed for init script on Ubuntu)
- introduced configuration mode - manual and automatic
- added support for automatic detection of interfaces (automatic configuration mode)
- fixed SEGFAULT after SIGTERM on Ubuntu (pcap_close replaced with pcap_breakloop)
- installation prefix /usr/local is no longer used
- added testing mode
- removed global buffer for logged messages
- added init script
- added support for user-defined script
- added defend interval as recommended by RFC 5227
- desktop notification was removed from daemon code
- added IPwatchD G Notify - Notification tool for Gnome environment
- added check for existence of "any" device - prevents segfaults with broken libpcap-1.0
- added Activity diagram

**1.1.1** (2008-09-21)
- fixed major bug in desktop notification
- few Makefile fixes

**1.1** (2008-08-13)
- added desktop notification support
- source code documentation generated with Doxygen
- fixed SIGTERM handling
- Makefile reformatted (should now build cleanly on RedHat with gcc3)
- added manual page

**1.0** (2007-08-05)
- rewritten in C
- daemon can handle multiple interfaces

**0.1** (2006-07-11)
- written in perl
- proof of the concept
- daemon can handle only one interface

## Links

[ARP patch](http://marc.merlins.org/linux/arppatch/)  
Patch for Linux kernel created by Marc Merlin

[MAC address](http://en.wikipedia.org/wiki/MAC_address)  
Article on Wikipedia

[Address Resolution Protocol](http://en.wikipedia.org/wiki/Address_Resolution_Protocol)  
Article on Wikipedia

[Gratuitous ARP](http://wiki.wireshark.org/Gratuitous_ARP)  
Article on Wireshark Wiki

[IPv4 Address Conflict Detection](http://www.ietf.org/rfc/rfc5227.txt)  
RFC 5227 from IETF (The Internet Engineering Task Force)

[The libpcap project](http://sourceforge.net/projects/libpcap/)  
Network packet capture library

[The libnet project](http://packetfactory.openwall.net/projects/libnet/)  
Network packet construction library

[Galago desktop presence framework](http://www.galago-project.org/)  
Desktop notification library

## About

IPwatchD was written and is maintained by **Jaroslav Imrich** - jariq(at)jariq(dot)sk

Many thanks goes to:

**Marc Merlin**  
... for his arppatch that helped me to understand IP conflicts.

**Justin Maggard**  
... for testing and various fixes.

**Jérémy Bobbio**  
... for libnotify 0.7 compatibility fix.

**Andrej Babolčai**  
... for helping me to perform tests with various operating systems and Gratuitous ARP.

**Tomáš Haluška**  
... for giving me a hand with this website.

**Martin Belian**
... for his contribution to the desktop notification part.

**Luboš Rendek**  
... for creating an alternative source of information about IPwatchD at linuxconfig.org.


#  

&copy; 2007-2015 Jaroslav Imrich
